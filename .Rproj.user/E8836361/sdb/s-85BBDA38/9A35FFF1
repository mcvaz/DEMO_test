{
    "collab_server" : "",
    "contents" : "---\ntitle: \"Within plots\"\nauthor: \"M. Vaz\"\ndate: \"April 22, 2017\"\noutput: html_document\n---\n\n```{r, message=FALSE, warning=FALSE, include=FALSE}\n\n# Loading and preparing data\n\nsites = read.csv(\"sites.csv\",header=T,as.is=T)\nhead(sites)\n\ncens = read.csv(\"censuses.csv\",header=T,as.is=T)\nhead(cens)\n\ngg = read.csv(\"growth.csv\",header=T,as.is=T)\nhead(gg)  \nstr(gg)\n\nmm = read.csv(\"mort.csv\",header=T,as.is=T)\nhead(mm)\nstr(mm)\n\n# species (full) names\ngg$sp = paste(gg$genus,gg$species)\nmm$sp = paste(mm$genus,mm$species)\n\n# merging mortality and growth tables\ndd = merge(gg,mm,all=T)\n\n```\n\n# Interspecific growth-mortality trade-off\n```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.height=10}\nlibrary(smatr)\nsource(\"asters.R\")\n\ncens$p10 = cens$sr10 = cens$slL10 = cens$slU10 = cens$sl10 = cens$intL10 = cens$intU10 = cens$int10 = cens$mm10 = cens$mg10 = NA\ncens$p100 = cens$sr100 = cens$slL100 = cens$slU100 = cens$sl100 = cens$intL100 = cens$intU100 = cens$int100 = cens$mm100 = cens$mg100 = NA\n\nfor(i in cens$code){\n\n## Demographic rates for each site-census\ng10 = subset(dd,code==i)$f10g # sapling growth rate\nm10 = subset(dd,code==i)$f10m # sapling mortality\ng100 = subset(dd,code==i)$f100g # adult growth\nm100 = subset(dd,code==i)$f100m # adult mortality\n# save median values\ncens[cens$code==i,c(\"mm10\",\"mg10\",\"mm100\",\"mg100\")] = c(median(m10,na.rm=T),median(g10,na.rm=T),median(m100,na.rm=T),median(g100,na.rm=T))\n\n## Standardized major axis regression\n# Saplings\nmod10 = sma(m10~g10,log=\"xy\")\ni10 = mod10$coef[[1]][1,1]\niU10 = mod10$coef[[1]][1,3]\niL10 = mod10$coef[[1]][1,2]\ns10 = mod10$coef[[1]][2,1]\nsU10 = mod10$coef[[1]][2,3]\nsL10 = mod10$coef[[1]][2,2]\nr10 = mod10$r2[[1]]\np10a = mod10$pval[[1]]\np10 = asters(p10a)\n# Adults\nmod100 = sma(m100~g100,log=\"xy\")\ni100 = mod100$coef[[1]][1,1]\niU100 = mod100$coef[[1]][1,3]\niL100 = mod100$coef[[1]][1,2]\ns100 = mod100$coef[[1]][2,1]\nsU100 = mod100$coef[[1]][2,3]\nsL100 = mod100$coef[[1]][2,2]\nr100 = mod100$r2[[1]]\np100a = mod100$pval[[1]]\np100 = asters(p100a)\n# Save values\ncens[cens$code==i,c(\"int10\",\"intU10\",\"intL10\",\"sl10\",\"slU10\",\"slL10\",\"sr10\",\"p10\",\"int100\",\"intU100\",\"intL100\",\"sl100\",\"slU100\",\"slL100\",\"sr100\",\"p100\")] = c(i10,iU10,iL10,s10,sU10,sL10,r10,p10a,i100,iU100,iL100,s100,sU100,sL100,r100,p100a)\n\n### Graphics\npar(mfrow=c(3,2))\n# Titles\ngt = paste(c(subset(cens,code==i,select=c(\"site\",\"t0\",\"t1\"))),collapse=\"-\")\ngt10 = paste(c(subset(cens,code==i,select=c(\"site\",\"t0\",\"t1\")),\"saplings\"),collapse=\"-\")\ngt100 = paste(c(subset(cens,code==i,select=c(\"site\",\"t0\",\"t1\")),\"adults\"),collapse=\"-\")\n\n## Rate distribution\n# Growth\nplot(density(g10,na.rm=T,adjust=4),col=2,main=gt,xlab=\"Estimated growth rate (%)\")\nlines(density(g100,na.rm=T,adjust=4),col=4)\nlegend(x=\"topright\",lty=1,legend=c(\"saplings\",\"adults\"),col=c(2,4),bty=\"n\")\n# Mortality\nplot(density(m10,na.rm=T,adjust=4),col=2,main=gt,xlab=\"Estimated mortality rate (%)\")\nlines(density(m100,na.rm=T,adjust=4),col=4)\nlegend(x=\"topright\",lty=1,legend=c(\"saplings\",\"adults\"),col=c(2,4),bty=\"n\")\n\n## Growth-mortality trade-off\n# Saplings\nplot(m10~g10,xlab=\"Growth rate (%)\",ylab=\"Mortality rate (%)\",main=gt10,log=\"xy\")\nabline(mod10,col=2)\nlegend(x=\"bottomright\",legend=paste(\"R2=\",round(r10,2),p10,sep=\"\"),bty=\"n\")\n# Adults\nplot(m100~g100,xlab=\"Growth rate (%)\",ylab=\"Mortality rate (%)\",main=gt100,log=\"xy\")\nabline(mod100,col=2)\nlegend(x=\"bottomright\",legend=paste(\"R2=\",round(r100,2),p100,sep=\"\"),bty=\"n\")\n\n## Residuals vs. relative abundance\n# Relative abundances\na10 = subset(dd,code==i)$n10m*100/sum(subset(dd,code==i)$n10m,na.rm=T)\na10 = a10[as.numeric(row.names(mod10$data))]\na100 = subset(dd,code==i)$n100m*100/sum(subset(dd,code==i)$n100m,na.rm=T)\na100 = a100[as.numeric(row.names(mod100$data))]\n\n# Regressions\nmod10b = lm(log(a10)~residuals(mod10))\nr10b = summary(mod10b)$adj.r.squared\np10b = summary(mod10b)$coefficients[2,4]\np10b = asters(p10b)  \nmod100b = lm(log(a100)~residuals(mod100))\nr100b = summary(mod100b)$adj.r.squared\np100b = summary(mod100b)$coefficients[2,4]\np100b = asters(p100b) \n# include a10~residuals(mod100) -> expect species that escape the g-m trade-off to have lower recruitment (therefore lower n10)\n\n## Graphics\n# Saplings\nplot(log(a10)~residuals(mod10),xlab=\"SMA residuals\",ylab=\"log(Relative abundance (%))\",main=gt10)\nabline(mod10b,col=2)\nlegend(x=\"bottomright\",legend=paste(\"R2=\",round(r10b,2),p10b,sep=\"\"),bty=\"n\")\n# Adults\nplot(log(a100)~residuals(mod100),xlab=\"SMA residuals\",ylab=\"log(Relative abundance (%))\",main=gt100)\nabline(mod100b,col=2)\nlegend(x=\"bottomright\",legend=paste(\"R2=\",round(r100b,2),p100b,sep=\"\"),bty=\"n\")\n\n}\n\npar(mfrow=c(1,1))\n\nwrite.csv(cens,\"censuses2.csv\")\n\n```\n\n\n\n\n",
    "created" : 1493755455706.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "963929548",
    "id" : "9A35FFF1",
    "lastKnownWriteTime" : 1493759672,
    "last_content_update" : 1493759672719,
    "path" : "~/GitHub/DEMO_test/DEMO_test_withinPlots.Rmd",
    "project_path" : "DEMO_test_withinPlots.Rmd",
    "properties" : {
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}