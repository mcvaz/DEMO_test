{
    "collab_server" : "",
    "contents" : "---\ntitle: \"Preliminary analyses - Species\"\nauthor: \"M. Vaz\"\ndate: \"February 3, 2017\"\noutput: html_document\n---\n\n# Basic stats\n```{r,echo=FALSE}\n\nraw2 = read.csv(\"raw2.csv\",header=T,as.is=T)\npaste(\"number of species sampled: \",length(unique(raw2$sp))) # number of trees sampled\n\n# correct crown major and minor diameters\ntmp = cbind(raw2$cd1/100,raw2$cd2/100)\nraw2$cd1c = apply(tmp,1,max)\nraw2$cd2c = apply(tmp,1,min)\n\n# estimates crown density\nraw2$cDens = raw2$dL/raw2$cTh\n\n# crown shape (roundness)\nraw2$cSh = raw2$cd2c/raw2$cd1c\n\n# calculate means for each species\nmm = aggregate(cbind(cmax,tL,bM1c,bM0c,sDens,RcTh,RcPos,tL,taper,HGE,rgrBc,LIEc,LUEc,cDens,cSh,Hmax)~sp,raw2,mean,na.rm=T,na.action=NULL)\nhead(mm)\n\n```\n\n# Architecture: crown and stem\n```{r,echo=FALSE}\n\nplot(mm$sDens,mm$tL,xlab=\"Stem density (g cm^3)\",ylab=\"Light intercepted (% m^2)\",main=\"\")\nmod5 = lm(mm$tL~mm$sDens)\nsummary(mod5)\n\nplot(mm$HGE,mm$tL,xlab=\"Height gain efficiency (cm g^-1)\",ylab=\"Light intercepted (% m^2)\",main=\"\",xlim=c(0,5))\nplot(mm$HGE,mm$RcPos,xlab=\"Height gain efficiency (cm g^-1)\",ylab=\"Relative crown position (%)\",main=\"\",xlim=c(0,5))\nplot(mm$HGE,mm$rgrBc,xlab=\"Height gain efficiency (cm g^-1)\",ylab=\"Relative crown position (%)\",main=\"\",xlim=c(0,5))\n\nplot(log(mm$LIEc),log(mm$LUEc),xlab=\"log(LIE)\",ylab=\"log(LUE)\")\nmod6 = lm(log(mm$LUEc)~log(mm$LIEc))\nsummary(mod6)\ntext(1,7.5,expression(paste(R^2,\"= 0.52***\")),col=2)\nabline(mod6,col=2)\nsubset(mm,LUEc>exp(6))\n\n\n#plot(mm[,-1])\n\n```\n\n# Hmax\n```{r,echo=FALSE}\n\n# Hmax x RGR\nplot(mm$Hmax,mm$rgrBc,xlab=\"Hmax\",ylab=\"RGR\")\nmod = lm(mm$rgrBc~mm$Hmax)\nsummary(mod)\n\n# Hmax x sDens\nplot(mm$Hmax,mm$sDens,xlab=\"Hmax\",ylab=\"Stem density\")\nmod = lm(mm$sDens~mm$Hmax)\nsummary(mod)\n\n# Hmax x HGE\nplot(mm$Hmax,mm$HGE,xlab=\"Hmax\",ylab=\"HGE\")\nmod = lm(mm$HGE~mm$Hmax)\nsummary(mod)\n#plot(mod) # outlier\nsubset(raw2,HGE>6,select=\"sp\")\n\nplot(mm$Hmax,mm$HGE,xlab=\"Hmax\",ylab=\"HGE\",ylim=c(0,4))\nmod = lm(subset(mm,HGE<6,select=HGE,drop=T)~subset(mm,HGE<6,select=Hmax,drop=T))\nsummary(mod) # without outlier\nabline(mod,col=2)\ntext(9,4,expression(paste(R^2,\" = 0.04*\")),col=2)\n\n# Hmax x LIE\nplot(mm$Hmax,mm$LIEc,xlab=\"Hmax\",ylab=\"LIE\")\nmod = lm(mm$LIEc~mm$Hmax)\nsummary(mod)\nabline(mod,col=2)\ntext(30,170,expression(paste(R^2,\" = 0.06*\")),col=2)\n\n# Hmax x LUE\nplot(subset(mm,LUEc<100 & LUEc>-50,select=c(\"Hmax\",\"LUEc\")),xlab=\"Hmax\",ylab=\"LUE\")\nmod = lm(subset(mm,LUEc<100 & LUEc>-50,select=\"LUEc\",drop=T)~subset(mm,LUEc<100 & LUEc>-50,select=\"Hmax\",drop=T))\nsummary(mod)\n#plot(mod)\n\n```\n\n# PCA\n```{r,echo=FALSE}\n\nbv = c(\"sDens\",\"RcTh\",\"RcPos\",\"RcPos\",\"tL\",\"HGE\",\"rgrBc\",\"LIEc\",\"LUEc\",\"cDens\",\"cSh\",\"Hmax\")\ndd = na.omit(scale(mm[,bv]))\n\npca = prcomp(dd[,1:(ncol(dd)-1)])\nsummary(pca)\nss = predict(pca)\n\nplot(pca$sdev^2*100/sum(pca$sdev^2),type=\"b\",xlab=\"PC\",ylab=\"Variance explained (%)\")\n\nsource(\"biplot.R\")\nbiplot(pca,1:2,7,.1)\nbiplot(pca,3:4,5,.1)\n\nplot(na.omit(dd[,\"Hmax\"]),ss[,1])\nplot(na.omit(dd[,\"Hmax\"]),ss[,2])\nplot(na.omit(dd[,\"Hmax\"]),ss[,3])\nplot(na.omit(dd[,\"Hmax\"]),ss[,4])\n\n```\n\n# Partial regression\n```{r,echo=FALSE}\n\ntmp = subset(mm,LUEc>0,select=c(\"cmax\",\"tL\",\"bM1c\",\"rgrBc\",\"bM0c\"))\ntmp$cmax = tmp$cmax/100+1.4\ntmp = na.omit(tmp)\ntmp = tmp[which(tmp$rgrBc>=0),]\n\n# HGE\nplot(y=tmp$cmax,tmp$bM1c,xlab=\"Estimated biomass (kg)\",ylab=\"Height (m)\")\nplot(y=log(tmp$cmax),log(tmp$bM1c),xlab=\"log Estimated biomass (kg)\",ylab=\"log Height (m)\")\nhb = lm(log(tmp$cmax)~log(tmp$bM1c))\nabline(hb,col=2)\nsummary(hb)\ntext(-1.7,1.8,expression(paste(R^2,\"=0.57***\")),col=2)\n\n# LIE\nplot(y=tmp$tL,tmp$bM1c,xlab=\"Estimated biomass (kg)\",ylab=\"Estimated light interception\")\nplot(y=log(tmp$tL),log(tmp$bM1c),xlab=\"log Estimated biomass (kg)\",ylab=\"log Estimated light interception\")\nlb = lm(log(tmp$tL)~log(tmp$bM1c))\nabline(lb,col=2)\nsummary(lb)\ntext(-1.7,5.5,expression(paste(R^2,\"=0.34***\")),col=2)\n\n# HGE x LIE\nplot(x=hb$residuals,lb$residuals,xlab=\"HGE\",ylab=\"LIE\")\nhlb = lm(lb$residuals~hb$residuals)\n#abline(hlb,col=2)\nsummary(hlb)\n\n# LUE\nplot(x=tmp$tL,tmp$rgrBc,ylab=\"RGR\",xlab=\"Estimated light interception\")\nplot(x=log(tmp$tL),log(tmp$rgrBc),ylab=\"log RGR\",xlab=\"log Estimated light interception\")\ngl = lm(log(tmp$rgrBc)~log(tmp$tL))\nabline(gl,col=2)\nsummary(gl)\ntext(1.4,-1,expression(paste(R^2,\"=0.10***\")),col=2)\n\n# LUE2\nplot(x=tmp$tL,tmp$bM1c-tmp$bM0c,ylab=\"RGR\",xlab=\"Estimated light interception\")\nplot(x=log(tmp$tL),log(tmp$bM1c-tmp$bM0c),ylab=\"log Absolute growth\",xlab=\"log Estimated light interception\")\ngl2 = lm(log(tmp$bM1c-tmp$bM0c)~log(tmp$tL))\nabline(gl2,col=2)\nsummary(gl2)\ntext(1.4,-1,expression(paste(R^2,\"=0.43***\")),col=2)\n\n# LIExLUE\nplot(lb$residuals,y=gl$residuals,xlab=\"light-biomass residuals\",ylab=\"growth-light residuals\")\nll = lm(gl$residuals~lb$residuals)\nsummary(ll)\n\n# LIE, HGE, LUE x Hmax - Residuals\ntmp2 = subset(mm,select=c(\"cmax\",\"tL\",\"bM1c\",\"rgrBc\",\"Hmax\",\"LIEc\",\"LUEc\"))\ntmp2$cmax = tmp2$cmax/100+1.4\ntmp2 = na.omit(tmp2)\ntmp2 = tmp2[which(tmp2$rgrBc>=0),]\nhb2 = lm(log(tmp2$cmax)~log(tmp2$bM1c))\nlb2 = lm(log(tmp2$tL)~log(tmp2$bM1c))\ngl2 = lm(log(tmp2$rgrBc)~log(tmp2$tL))\n\nplot(tmp2$Hmax,hb2$residuals,xlab=\"Hmax\",ylab=\"HGE\")\nsummary(lm(hb2$residuals~tmp2$Hmax))\n\nplot(tmp2$Hmax,lb2$residuals,xlab=\"Hmax\",ylab=\"LIE\")\nsummary(lm(lb2$residuals~tmp2$Hmax))\n\nplot(tmp2$Hmax,gl2$residuals,xlab=\"Hmax\",ylab=\"LUE\")\nsummary(lm(gl2$residuals~tmp2$Hmax))\n\n\n# LUE x LIE - Permutation test\ntmp = subset(mm,bM1c-bM0c>0 & !is.na(tL))\nnrow(tmp)\nobs = cor(log((tmp$bM1c-tmp$bM0c)/tmp$tL),log(tmp$tL/tmp$bM1c))\ncor.test(log((tmp$bM1c-tmp$bM0c)/tmp$tL),log(tmp$tL/tmp$bM1c))\n\nres = numeric()\nfor(i in 1:9999){\n  tmptL = sample(tmp$tL)\n  tmpDb = sample(tmp$bM1c-tmp$bM0c)\n  tmpB1 = sample(tmp$bM1c)\n  res[i] = cor(log((tmpDb)/tmptL),log(tmptL/tmpB1))\n  }\nres = c(res,obs)\npp = sum(res<obs)/10000\n\nhist(res,xlab=\"Pearson's R\",main=\"Permutation test\")\nabline(v=quantile(res,.05),col=2,lty=3)\narrows(obs,500,obs,0,col=4,length=.1)\nlegend(x=\"topright\",c(\"R\",\"=\",round(obs,2),\"\",\"p\",\"=\",pp),bty=\"n\",text.col=2)\n\n\n# LUE x LIE - SMA\nlibrary(smatr)\nsource(\"regr.plot.R\")\ntmp = subset(mm,!is.na(LUEc) & LUEc>0 & LUEc<300)\nnrow(tmp)\nmod = sma(log(tmp$LIEc)~log(tmp$LUEc))\nregr.plot(mod)\ncols = topo.colors(40,alpha=.7)[round(tmp$Hmax)]\n\nplot(log(tmp$LIEc),log(tmp$LUEc),xlab=\"log(LIE)\",ylab=\"log(LUE)\",col=cols,pch=16)\nlegend(x=\"topright\",legend=seq(5,35,5),col=topo.colors(40,alpha=.7)[seq(5,35,5)],bty=\"n\",pch=16,title=\"Maximum height (m)\")\nabline(mod,col=\"grey\")\ntext(\"R^2 = 0.70***\",col=2,x=2.5,y=1.2)\n\n# Plot residuals from SMA against plot abundances\nmaxsizes = read.csv(\"maxsizes.csv\",header=T)\nmaxsizes$sp = paste(maxsizes$Genus,maxsizes$epithet)\nhead(maxsizes)\n\ntmp2 = subset(tmp,sp%in%maxsizes$sp)\nnrow(tmp2)\nrow.names(maxsizes) = maxsizes$sp\ntmp2$n = maxsizes[tmp2$sp,\"n\"]\ntmp2 = tmp2[-16,]\nhead(tmp2)\nmod2 = sma(log(tmp2$LIEc)~log(tmp2$LUEc))\nregr.plot(mod2)\nplot(residuals(mod2),y=log(tmp2$n),xlab=\"SMA residuals\",ylab=\"Abundance\")\nmod3 = lm(log(tmp2$n)~residuals(mod2))\nsummary(mod3)\nabline(mod3,col=2)\ntext(.5,2,expression(paste(R^2,\"=0.05*\")),col=2)\n\n\n# LUE x LIE - PCA\npca = prcomp(log(tmp[,c(\"LUEc\",\"LIEc\")]),scale.=T)\nsummary(pca)\nss = predict(pca)\nplot(ss[,1],ss[,2]);abline(v=0,h=0,lty=3,col=\"grey\")\n#text(c(\"LIE\",\"LUE\"),x=pca$rotation[,1],y=pca$rotation[,2])\n\nplot(ss[,1]~tmp$Hmax,ylim=c(-2.5,2),xlab=\"Hmax\",ylab=\"PC1\")\nmod = lm(ss[,1]~tmp$Hmax)\nsummary(mod)\nabline(mod,col=2)\ntext(30,2,expression(paste(R^2,\"=0.05*\")),col=2)\n\n\n```\n\n\n\n\n",
    "created" : 1493053587774.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1986714730",
    "id" : "27D0D2CE",
    "lastKnownWriteTime" : 1489556979,
    "last_content_update" : 1489556979,
    "path" : "~/Desktop/QUAL/preSpec.Rmd",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}